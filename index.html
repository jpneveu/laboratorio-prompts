<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio de Prompts - por Juan Pablo Neveu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .code { font-family: 'Source Code Pro', monospace; }
        /* Simple transition for smooth appearance */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-900">Laboratorio de Prompts</h1>
            <p class="mt-2 text-lg text-gray-600">Descubre cómo cada componente de un prompt refina la respuesta de la IA.</p>
            <p class="text-sm text-gray-500 mt-1">Una demo por Juan Pablo Neveu</p>
        </header>

        <!-- Main Content Grid -->
        <main class="grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <!-- Left Column: Controls -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-2xl font-bold mb-2">1. Defina la Tarea</h2>
                <p class="mb-6 text-gray-600">El objetivo es fijo: la IA debe redactar un email profesional para solicitar una reunión.</p>

                <div class="space-y-6">
                    <div>
                        <label for="persona" class="block text-sm font-medium text-gray-700"># Persona (Quién es la IA)</label>
                        <select id="persona" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="">[Sin Persona Definida]</option>
                            <option value="Actúa como un Asistente Ejecutivo Senior, muy formal y eficiente.">Asistente Ejecutivo Senior</option>
                            <option value="Actúa como un Emprendedor amigable y directo. Tu objetivo es conectar.">Emprendedor Amistoso</option>
                            <option value="Actúa como un Académico Investigador que busca colaborar en un proyecto.">Académico Investigador</option>
                        </select>
                    </div>
                    <div>
                        <label for="contexto" class="block text-sm font-medium text-gray-700">## Contexto (Cuál es la situación)</label>
                        <select id="contexto" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="El email es un primer contacto en frío a un gerente importante.">Email en frío</option>
                            <option value="El email es para hacer seguimiento a una conversación que tuvimos en un evento.">Seguimiento de evento</option>
                            <option value="El email es para un colega de otro departamento dentro de la misma empresa.">Contacto interno</option>
                        </select>
                    </div>
                    <div>
                        <label for="tono" class="block text-sm font-medium text-gray-700">### Tono (Cómo debe sonar)</label>
                        <select id="tono" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="Utiliza un tono muy formal y respetuoso.">Muy Formal y Respetuoso</option>
                            <option value="Utiliza un tono directo, profesional y conciso.">Directo y Conciso</option>
                            <option value="Utiliza un tono cordial y entusiasta.">Cordial y Entusiasta</option>
                        </select>
                    </div>
                    <div>
                        <label for="restriccion" class="block text-sm font-medium text-gray-700">#### Restricción (Qué regla debe seguir)</label>
                        <select id="restriccion" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="">[Sin Restricción]</option>
                            <option value="El email completo debe tener menos de 100 palabras.">Menos de 100 palabras</option>
                            <option value="El email debe terminar con una pregunta abierta para fomentar la respuesta.">Terminar con pregunta abierta</option>
                            <option value="El email debe mencionar un logro reciente (ficticio) del destinatario para personalizarlo.">Mencionar un logro</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="space-y-8">
                <!-- Constructed Prompt -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4">2. Prompt Construido</h2>
                    <div class="bg-gray-900 text-white p-4 rounded-lg">
                        <pre class="code text-sm whitespace-pre-wrap"><code id="prompt-output"></code></pre>
                    </div>
                </div>

                <!-- AI Response -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold">3. Respuesta de la IA</h2>
                        <button id="generate-btn" class="flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200">
                            <span id="btn-text">Generar</span>
                            <svg id="loader" class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="error-container" class="mt-4 p-4 bg-red-50 rounded-lg border border-red-200 text-red-700 hidden">
                        <p id="error-message"></p>
                    </div>
                    <div id="result-container" class="prose prose-indigo max-w-none text-gray-700 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[150px]">
                        <!-- AI response will be injected here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // DOM Elements
        const selectors = ['persona', 'contexto', 'tono', 'restriccion'].map(id => document.getElementById(id));
        const promptOutput = document.getElementById('prompt-output');
        const generateBtn = document.getElementById('generate-btn');
        const btnText = document.getElementById('btn-text');
        const loader = document.getElementById('loader');
        const resultContainer = document.getElementById('result-container');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');

        const baseTask = "Redacta un email profesional para solicitar una reunión con un colega o cliente potencial.";

        // Function to build the prompt from selected options
        function updateConstructedPrompt() {
            const parts = [baseTask];
            selectors.forEach(selector => {
                if (selector.value) {
                    parts.push(selector.value);
                }
            });
            promptOutput.textContent = parts.join('\n\n');
        }

        // Event Listeners for selectors
        selectors.forEach(selector => {
            selector.addEventListener('change', updateConstructedPrompt);
        });

        // Event Listener for Generate Button
        generateBtn.addEventListener('click', async () => {
            const finalPrompt = promptOutput.textContent;

            setLoading(true);
            hideError();
            resultContainer.innerHTML = ''; // Clear previous result

            try {
                const response = await fetch('/api/gemini-proxy', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: finalPrompt })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Ocurrió un error desconocido.');
                }

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                
                resultContainer.innerHTML = text.replace(/\n/g, '<br>'); // Display with line breaks
                resultContainer.classList.add('fade-in');


            } catch (error) {
                console.error("Error:", error);
                showError(error.message);
            } finally {
                setLoading(false);
            }
        });

        // UI Helper Functions
        function setLoading(isLoading) {
            generateBtn.disabled = isLoading;
            btnText.style.display = isLoading ? 'none' : 'inline';
            loader.style.display = isLoading ? 'inline-block' : 'none';
        }

        function showError(message) {
            errorMessage.textContent = `Error: ${message}`;
            errorContainer.classList.remove('hidden');
            errorContainer.classList.add('fade-in');
        }

        function hideError() {
            errorContainer.classList.add('hidden');
        }
        
        // Initial call to populate the prompt box
        updateConstructedPrompt();
    </script>
</body>
</html>
```javascript
// api/gemini-proxy.js

// This is a Vercel Serverless Function.
// It acts as a secure proxy to the Gemini API.

export default async function handler(request, response) {
  // 1. Only allow POST requests for security
  if (request.method !== 'POST') {
    return response.status(405).json({ message: 'Method Not Allowed' });
  }

  // 2. Get the user's prompt from the request body
  const { prompt } = request.body;

  if (!prompt) {
    return response.status(400).json({ error: 'Prompt is missing.' });
  }

  // 3. Get the secret API key from Vercel's Environment Variables
  const apiKey = process.env.GEMINI_API_KEY;
  if (!apiKey) {
      return response.status(500).json({ error: 'API key not configured on the server.' });
  }

  const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;

  try {
    // 4. Make the server-to-server call to the Gemini API
    const geminiResponse = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }],
      }),
    });

    // Handle potential errors from the Gemini API itself
    if (!geminiResponse.ok) {
      const errorText = await geminiResponse.text();
      console.error("Gemini API Error:", errorText);
      return response.status(geminiResponse.status).json({ error: `Gemini API error: ${errorText}` });
    }

    const data = await geminiResponse.json();
    
    // 5. Send the successful response back to the frontend
    return response.status(200).json(data);

  } catch (error) {
    console.error("Internal Server Error:", error);
    return response.status(500).json({ error: error.message });
  }
}