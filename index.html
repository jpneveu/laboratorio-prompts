<!-- index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio de Prompts v2: Comunicador Estratégico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .code { font-family: 'Source Code Pro', monospace; }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .prose-custom { white-space: pre-wrap; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-900">Laboratorio de Prompts: Comunicador Estratégico</h1>
            <p class="mt-2 text-lg text-gray-600">Diseña un hilo para redes sociales combinando componentes estratégicos.</p>
            <p class="text-sm text-gray-500 mt-1">Una demo por Juan Pablo Neveu</p>
        </header>

        <!-- Main Content Grid -->
        <main class="grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <!-- Left Column: Controls -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-2xl font-bold mb-6">1. Diseñe su Comunicación</h2>

                <div class="space-y-6">
                    <div>
                        <label for="anuncio" class="block text-sm font-medium text-gray-700">## Anuncio Central</label>
                        <input type="text" id="anuncio" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ej: Lanzamiento de un nuevo curso sobre IA...">
                    </div>
                    <div>
                        <label for="plataforma" class="block text-sm font-medium text-gray-700"># Plataforma Social</label>
                        <select id="plataforma" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="El hilo debe ser optimizado para LinkedIn, con un tono profesional y párrafos más desarrollados.">LinkedIn</option>
                            <option value="El hilo debe ser optimizado para Twitter/X, con un tono conciso, impactante y usando emojis relevantes.">Twitter/X</option>
                        </select>
                    </div>
                    <div>
                        <label for="audiencia" class="block text-sm font-medium text-gray-700">### Audiencia Objetivo</label>
                        <select id="audiencia" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="La audiencia principal son docentes y directivos de instituciones educativas.">Docentes y Directivos</option>
                            <option value="La audiencia principal son emprendedores y líderes de PyMEs.">Emprendedores y PyMEs</option>
                            <option value="La audiencia principal son estudiantes universitarios de carreras tecnológicas.">Estudiantes Universitarios</option>
                        </select>
                    </div>
                    <div>
                        <label for="voz" class="block text-sm font-medium text-gray-700">#### Voz de la Marca/Institución</label>
                        <select id="voz" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="Utiliza una voz académica, formal y rigurosa.">Académica y Rigurosa</option>
                            <option value="Utiliza una voz innovadora, energética y disruptiva.">Innovadora y Disruptiva</option>
                            <option value="Utiliza una voz cercana, comunitaria y colaborativa.">Cercana y Comunitaria</option>
                        </select>
                    </div>
                    <div>
                        <label for="cta" class="block text-sm font-medium text-gray-700">##### Llamado a la Acción (CTA)</label>
                        <select id="cta" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            <option value="El hilo debe concluir con un llamado a la acción claro para que se registren en un formulario.">Invitar a un Registro</option>
                            <option value="El hilo debe concluir con un llamado a la acción que genere debate, haciendo una pregunta abierta a la audiencia.">Generar Debate</option>
                            <option value="El hilo debe concluir con un llamado a la acción que dirija a los lectores a un artículo de blog para obtener más información.">Dirigir a un Artículo</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Right Column: Results -->
            <div class="space-y-8">
                <!-- Constructed Prompt -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4">2. Prompt Construido</h2>
                    <div class="bg-gray-900 text-white p-4 rounded-lg">
                        <pre class="code text-sm whitespace-pre-wrap"><code id="prompt-output"></code></pre>
                    </div>
                </div>

                <!-- AI Response -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold">3. Respuesta de la IA</h2>
                        <button id="generate-btn" class="flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200">
                            <span id="btn-text">Generar</span>
                            <svg id="loader" class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="error-container" class="mt-4 p-4 bg-red-50 rounded-lg border border-red-200 text-red-700 hidden">
                        <p id="error-message"></p>
                    </div>
                    <div id="result-container" class="prose max-w-none text-gray-700 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[200px] prose-custom">
                        <!-- AI response will be injected here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // DOM Elements
        const anuncioInput = document.getElementById('anuncio');
        const selectors = ['plataforma', 'audiencia', 'voz', 'cta'].map(id => document.getElementById(id));
        const promptOutput = document.getElementById('prompt-output');
        const generateBtn = document.getElementById('generate-btn');
        const btnText = document.getElementById('btn-text');
        const loader = document.getElementById('loader');
        const resultContainer = document.getElementById('result-container');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');

        const baseTask = "Actúa como un experto en comunicación digital y Social Media Manager. Tu tarea es redactar un borrador de un hilo para redes sociales (una secuencia de posteos numerados) para comunicar un anuncio importante. El resultado debe ser un texto listo para copiar y pegar.";

        // Function to build the prompt from selected options
        function updateConstructedPrompt() {
            const anuncioValue = anuncioInput.value.trim();
            if (!anuncioValue) {
                promptOutput.textContent = "Por favor, ingrese el anuncio central para construir el prompt.";
                return;
            }

            const parts = [
                baseTask,
                `El anuncio central es sobre: "${anuncioValue}"`
            ];
            selectors.forEach(selector => {
                if (selector.value) {
                    parts.push(selector.value);
                }
            });
            promptOutput.textContent = parts.join('\n\n');
        }

        // Event Listeners
        [anuncioInput, ...selectors].forEach(element => {
            element.addEventListener('change', updateConstructedPrompt);
            element.addEventListener('keyup', updateConstructedPrompt);
        });

        // Event Listener for Generate Button
        generateBtn.addEventListener('click', async () => {
            if (!anuncioInput.value.trim()) {
                showError("El campo 'Anuncio Central' no puede estar vacío.");
                return;
            }
            const finalPrompt = promptOutput.textContent;

            setLoading(true);
            hideError();
            resultContainer.innerHTML = '';

            try {
                const response = await fetch('/api/gemini-proxy', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: finalPrompt })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Ocurrió un error desconocido.');
                }

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                
                resultContainer.innerHTML = text;
                resultContainer.classList.add('fade-in');

            } catch (error) {
                console.error("Error:", error);
                showError(error.message);
            } finally {
                setLoading(false);
            }
        });

        // UI Helper Functions
        function setLoading(isLoading) {
            generateBtn.disabled = isLoading;
            btnText.style.display = isLoading ? 'none' : 'inline';
            loader.style.display = isLoading ? 'inline-block' : 'none';
        }

        function showError(message) {
            errorMessage.textContent = `Error: ${message}`;
            errorContainer.classList.remove('hidden');
            errorContainer.classList.add('fade-in');
        }

        function hideError() {
            errorContainer.classList.add('hidden');
        }
        
        // Initial call
        updateConstructedPrompt();
    </script>
</body>
</html>
```javascript
// api/gemini-proxy.js

// This is a Vercel Serverless Function.
// It acts as a secure proxy to the Gemini API.

export default async function handler(request, response) {
  // 1. Only allow POST requests for security
  if (request.method !== 'POST') {
    return response.status(405).json({ message: 'Method Not Allowed' });
  }

  // 2. Get the user's prompt from the request body
  const { prompt } = request.body;

  if (!prompt) {
    return response.status(400).json({ error: 'Prompt is missing.' });
  }

  // 3. Get the secret API key from Vercel's Environment Variables
  const apiKey = process.env.GEMINI_API_KEY;
  if (!apiKey) {
      return response.status(500).json({ error: 'API key not configured on the server.' });
  }

  // Using the model you confirmed works well
  const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;

  try {
    // 4. Make the server-to-server call to the Gemini API
    const geminiResponse = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }],
      }),
    });

    // Handle potential errors from the Gemini API itself
    if (!geminiResponse.ok) {
      const errorText = await geminiResponse.text();
      console.error("Gemini API Error:", errorText);
      return response.status(geminiResponse.status).json({ error: `Gemini API error: ${errorText}` });
    }

    const data = await geminiResponse.json();
    
    // 5. Send the successful response back to the frontend
    return response.status(200).json(data);

  } catch (error) {
    console.error("Internal Server Error:", error);
    return response.status(500).json({ error: error.message });
  }
}
